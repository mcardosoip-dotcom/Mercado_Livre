CREATE OR REPLACE TABLE SBOX_LEGALES.STG_QS_AUX_PAYOUT_REL_CAD_VF_FINCH AS (
SELECT
DISTINCT
MOV.ID_PAGAMENTO
,CODIGO_CHAVE_EXTRATO
,UPPER(TRIM(WIT.PYT_PRVDR_DATA_DEST_BANK_NAME)) AS NOME_BANCO_REL
,INSTITUT.NUMERO_CODIGO AS NUMERO_BANCO_REL
,REGEXP_REPLACE(WIT.PYT_PRVDR_DATA_DEST_BRANCH, '[^a-zA-Z0-9]','') AS NUMERO_AGENCIA_REL
,REGEXP_REPLACE(WIT.PYT_PRVDR_DATA_DEST_NUMBER, '[^a-zA-Z0-9]','') AS NUMERO_CONTA_REL 
,'4' AS TIPO_CONTA_REL
,CASE 
WHEN WIT.PYT_PRVDR_DATA_DEST_IDENT_TYPE = 'CPF' THEN '1' 
WHEN WIT.PYT_PRVDR_DATA_DEST_IDENT_TYPE = 'CNPJ' THEN '2' 
ELSE NULL
END AS TIPO_PESSOA_REL
,CAST(WIT.PYT_PRVDR_DATA_DEST_IDENT_NUMBER AS STRING) 
AS CPF_CNPJ_REL
,UPPER(WIT.PYT_PRVDR_DATA_DEST_HOLDER)
AS NOME_PESSOA_REL

FROM SBOX_LEGALES.STG_QS_AUX_PAYOUT_CAD_VF_FINCH MOV

LEFT JOIN WHOWNER.BT_MP_PAYOUTS WIT ON CAST(MOV.ID_PAGAMENTO AS STRING) = CAST(WIT.PAYOUT_ID AS STRING)
LEFT JOIN SBOX_LEGALES.Dim_Instituicoes INSTITUT ON WIT.PYT_PRVDR_DATA_DEST_BANK_ID = CAST(INSTITUT.ISPB AS STRING));
