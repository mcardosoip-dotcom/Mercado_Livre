CREATE OR REPLACE TABLE SBOX_LEGALES.STG_QS_AUX_PAYIN_REL_CAD_VF_FINCH AS (
SELECT
DISTINCT
 MOV.ID_PAGAMENTO
,CODIGO_CHAVE_EXTRATO
,UPPER(TRIM(WIT.PYN_COLLECTOR_BANK_NAME)) AS NOME_BANCO_REL
,INSTITUT.NUMERO_CODIGO AS NUMERO_BANCO_REL
,'' AS NUMERO_AGENCIA_REL
,REGEXP_REPLACE(CAST(WIT.PYN_BUY_ACCOUNT_ID AS STRING) , '[^a-zA-Z0-9]','') AS NUMERO_CONTA_REL 
,'4' AS TIPO_CONTA_REL
,CASE 
WHEN WIT.PYN_PAYER_IDENTIFICATION_TYPE  = 'CPF' THEN '1' 
WHEN WIT.PYN_PAYER_IDENTIFICATION_TYPE  = 'CNPJ' THEN '2' 
ELSE NULL
END AS TIPO_PESSOA_REL
,CAST(WIT.PYN_PAYER_IDENTIFICATION_NUMBER AS STRING) 
AS CPF_CNPJ_REL
,UPPER(WIT.PYN_PAYER_NAME)
AS NOME_PESSOA_REL

FROM SBOX_LEGALES.STG_QS_AUX_PAYIN_CAD_VF_FINCH MOV

LEFT JOIN WHOWNER.BT_MP_PAY_PAYIN WIT ON CAST(MOV.ID_PAGAMENTO AS STRING) = CAST(WIT.PYN_ID AS STRING)
LEFT JOIN SBOX_LEGALES.Dim_Instituicoes INSTITUT ON WIT.PYN_BUY_BANK_ID = CAST(INSTITUT.ISPB AS STRING));
