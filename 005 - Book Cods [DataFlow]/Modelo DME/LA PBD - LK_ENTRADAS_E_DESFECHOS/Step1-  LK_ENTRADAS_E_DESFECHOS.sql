-- DEV
-- ddme000426-gopr4nla6zo-furyid

-- PROD
-- pdme000426-c1s7scatwm0-furyid

-- Limpeza da tabela de destino
TRUNCATE TABLE `<ENV>.TBL.LK_ENTRADAS_E_DESFECHOS`;

-- Inserção de dados tratados
INSERT INTO `<ENV>.TBL.LK_ENTRADAS_E_DESFECHOS` (
    ID,
    PAIS,
    STATUS,
    AREA_DIREITO,
    SUB_AREA_DIREITO,
    NUMERO_PROCESSO,
    ACAO,
    ADVOGADO_PARTE_CONTRARIA_CONTUMAZ,
    ADVOGADO_PARTE_CONTRARIA_NOME,
    ADVOGADO_RESPONSAVEL,
    CARATULA,
    CAUSAS_RAIZES,
    CAUSAS_RAIZES_1,
    CAUSAS_RAIZES_2,
    CLIENTE,
    CUST_ID_AUTOR,
    CUST_ID_CONTRAPARTE,
    DATA_AUDIENCIA_INICIAL,
    DATA_CITACAO,
    DATA_ENCERRAMENTO,
    DATA_REATIVACAO,
    DATA_REGISTRADO,
    DATA_REGISTRO_ENCERRAMENTO,
    DATABASE_UNIDADE,
    EMPRESA_RESPONSAVEL,
    EMPRESA_TRATADA,
    ESCRITORIO_RESPONSAVEL,
    ID_PAGAMENTO,
    VL_PRIM_INSTANCIA,
    VALOR_CAUSA,
    VALOR_RISCO,
    RISCO,
    PARTE_CONTRARIA_CPF,
    FASE_ESTADO,
    FASE_ESTADO_4,
    MODELO_CONTRATACAO,
    DESFECHO,
    UF,
    REGIAO,
    PROCEDIMENTO_JUDICIAL,
    OBJETO_TRATADO,
    SUPERENDIVIDAMENTO,
    TIPO_DE_CONTINGENCIA,
    PROCESSO_FORO_TRIBUNAL_ORGAO,
    AUD_INS_DTTM,
    AUD_UPD_DTTM,
    DATA_UPDATE
)
SELECT
    CAST(processo_id AS STRING) AS ID,
    PAIS,
    STATUS,
    AREA_DO_DIREITO AS AREA_DIREITO,
    SUB_AREA_DO_DIREITO AS SUB_AREA_DIREITO,
    NUMERO_DO_PROCESSO AS NUMERO_PROCESSO,
    ACAO,
    ADVOGADO_PARTE_CONTRARIA_CONTUMAZ,
    ADVOGADO_DA_PARTE_CONTRARIA_NOME AS ADVOGADO_PARTE_CONTRARIA_NOME,
    ADVOGADO_RESPONSAVEL,
    CARATULA,
    CAUSAS_RAIZES,
    CAUSAS_RAIZES_1,
    CAUSAS_RAIZES_2,
    CLIENTE,
    CAST(CUST_ID_AUTOR AS STRING) AS CUST_ID_AUTOR,
    CAST(CUST_ID_CONTRAPARTE AS STRING) AS CUST_ID_CONTRAPARTE,
    FORMAT_DATE('%F', SAFE.PARSE_DATE('%d/%m/%Y', DATA_AUDIENCIA_INICIAL)) AS DATA_AUDIENCIA_INICIAL,
    FORMAT_DATE('%F', SAFE.PARSE_DATE('%d/%m/%Y', DATA_DE_CITACAO)) AS DATA_CITACAO,
    FORMAT_DATE('%F', SAFE.PARSE_DATE('%d/%m/%Y', DATA_DE_ENCERRAMENTO)) AS DATA_ENCERRAMENTO,
    FORMAT_DATE('%F', SAFE.PARSE_DATE('%d/%m/%Y', DATA_DE_REATIVACAO)) AS DATA_REATIVACAO,
    FORMAT_DATE('%F', SAFE.PARSE_DATE('%d/%m/%Y', DATA_REGISTRADO)) AS DATA_REGISTRADO,
    FORMAT_DATE('%F', SAFE.PARSE_DATE('%d/%m/%Y', DATA_DE_REGISTRO_DO_ENCERRAMENTO)) AS DATA_REGISTRO_ENCERRAMENTO,
    UNIDADE_DE_NEGOCIO_IMPACTADA AS DATABASE_UNIDADE,
    EMPRESA_RESPONSAVEL,
    EMPRESA_TRATADA,
    PAGE_REPORT_ESCRITORIORESPONSAVEL AS ESCRITORIO_RESPONSAVEL,
    CAST(ID_DO_PAGAMENTO AS STRING) AS ID_PAGAMENTO,
    CAST(VALOR_1_INSTANCIA AS STRING) AS VL_PRIM_INSTANCIA,
    CAST(VALOR_DA_CAUSA AS STRING) AS VALOR_CAUSA,
    CAST(VALOR_DO_RISCO AS STRING) AS VALOR_RISCO,
    RISCO,
    PARTE_CONTRARIA_CPF,
    FASE_ESTADO,
    FASE_ESTADO_4,
    NULL AS MODELO_CONTRATACAO,
    FASE_DESFECHO AS DESFECHO,
    PROCESSO_ESTADO AS UF,
    REGIAO,
    PROCEDIMENTO_JUDICIAL,
    OBJETO_TRATADO,
    PROCESSO_SUPERENDIVIDAMENTO,
    TIPO_DE_CONTINGENCIA,
    PROCESSO_FORO_TRIBUNAL_ORGAO,
    CURRENT_DATETIME() AS AUD_INS_DTTM,
    CURRENT_DATETIME() AS AUD_UPD_DTTM,
    CURRENT_DATE() AS DATA_UPDATE
FROM
    `<ENV>.STG.LK_PBD_LA_ENTRADAS_E_DESFECHOS`;
